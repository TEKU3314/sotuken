{% extends 'base.html' %}

{% load static %}

{% block title %}Aichan | 画像生成{% endblock %}

{% block contents %}
<!-- 田平氏　-->
<!--<link rel="stylesheet" href="./css/tabi.css">-->
<div class="my-div-style">

    <!--　FORM　-->
    <form action="{% url 'generate:make' %}" id="ajax-number" method="post">
        {% csrf_token %}
        <h3>○○風</h3>
        {% for object in object_list %}    
            {% if object.name ==  'style' %}
            <div>    
                <input type="checkbox" name="style"  value="{{ object.word_en}}"> {{ object.word }}
            </div>
            {% endif %}
        {% endfor %}

        <h3>自然</h3>
        {% for object in object_list %}  
            {% if object.name ==  'nature' %}
            <div>
                <input type="checkbox" name="nature"  value="{{ object.word_en}}"> {{ object.word }}
            </div>
            {% endif %}
        {% endfor %}

        <h3>建物</h3>
        {% for object in object_list %}  
            {% if object.name ==  'building' %}
            <div>
                <input type="checkbox" name="building"  value="{{ object.word_en}}"> {{ object.word }}                
            </div>
            {% endif %}
        {% endfor %}

        <h3>海</h3>
        {% for object in object_list %}
            {% if object.name ==  'sea' %}
            <div>       
                <input type="checkbox" name="sea"  value="{{ object.word_en}}"> {{ object.word }}
            </div>
            {% endif %}
        {% endfor %}

        <h3>動物</h3>
        {% for object in object_list %} 
            {% if object.name ==  'animal' %}
            <div>
                <input type="checkbox" name="animal"  value="{{ object.word_en}}"> {{ object.word }}
            </div>
            {% endif %}
        {% endfor %}
        <input type="submit" value="生成">
    </form>   

    <!-- ダイアログ　-->
    <div class="msg"></div>
    <div class="loading hide"></div>

</div>
{% endblock %}

{% block extrajs %}
<script type="text/javascript">
        function getCookie(name) {
            var cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                var cookies = document.cookie.split(';');
                for (var i = 0; i < cookies.length; i++) {
                    var cookie = jQuery.trim(cookies[i]);
                    // Does this cookie string begin with the name we want?
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        var csrftoken = getCookie('csrftoken');

        function csrfSafeMethod(method) {
            // these HTTP methods do not require CSRF protection
            return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
        }

        $.ajaxSetup({
            beforeSend: function (xhr, settings) {
                if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                    xhr.setRequestHeader("X-CSRFToken", csrftoken);
                }
                //➀loading画面を作成する
                $('.loading').removeClass('hide');
            }
        });

        //ajaxで送信
        $('#ajax-number').on('submit', function(e) {
            event.preventDefault();

            $.ajax({
                'url': '{% url "generate:make" %}',
                'type': 'POST',
                //➁チェックボックスで選択したものをdata送る
                'data': {
                    'number1': '1'
                },
                'dataType': 'json',
            })
            .done(function(respone){
                //➀loading画面を作成する
                $('.loading').addClass('hide');          
                $('.msg').append('<p>NAME: ' + 'ss' + '</p>');

                //push.js
                    Push.create('こんにちは！', {
                        body: '更新をお知らせします！',
                        icon: 'index.jpg',
                        timeout: 5000,
                        onClick: function () {
                            this.close();
                            location.href = 'https://www.yahoo.co.jp';
                        }
                    });
            });
        });
</script>
{% endblock %}

